nv overlay evpn
feature bgp
feature interface-vlan
feature vn-segment-vlan-based
feature lldp
feature nv overlay
!
evpn multisite border-gateway 1
  dci-advertise-pip
!
hardware access-list tcam region racl 0
hardware access-list tcam region arp-ether 256 double-wide
!
vlan 10
  vn-segment 10010
vlan 20
  vn-segment 10020
vlan 500
  vn-segment 10500
!
ip prefix-list loopback0 seq 5 permit 192.0.2.0/24 eq 32 
route-map allow-loopback permit 10
  match ip address prefix-list loopback0 
route-map permit-all permit 10
!
vrf context tenant1
  vni 10500
  rd auto
  address-family ipv4 unicast
    route-target import 500:500
    route-target import 500:500 evpn
    route-target import 65500:500
    route-target import 65500:500 evpn
    route-target export 500:500 evpn
    route-target export 65500:500
    route-target export 65500:500 evpn
!
interface Vlan500
  no shutdown
  vrf member tenant1
  ip forward
!
interface nve1
  no shutdown
  host-reachability protocol bgp
  source-interface loopback0
  multisite border-gateway interface loopback1
  member vni 10010
    suppress-arp
    multisite ingress-replication
    ingress-replication protocol bgp
  member vni 10020
    suppress-arp
    multisite ingress-replication
    ingress-replication protocol bgp
  member vni 10500 associate-vrf
!
interface Ethernet1/1
  no switchport
  ip address 198.51.100.24/31
  no shutdown
  evpn multisite fabric-tracking
interface Ethernet1/2
  no switchport
  ip address 198.51.100.26/31
  no shutdown
  evpn multisite fabric-tracking
interface Ethernet1/3
  no switchport
  ip address 198.51.100.32/31
  no shutdown
  evpn multisite dci-tracking
!
interface loopback0
  ip address 192.0.2.14/32
interface loopback1
  ip address 192.0.2.114/32
!
router bgp 65414
  router-id 192.0.2.14
  bestpath as-path multipath-relax
  log-neighbor-changes
  address-family ipv4 unicast
    redistribute direct route-map allow-loopback
    maximum-paths 2
  address-family l2vpn evpn
    maximum-paths 64
  template peer spine-overlay
    remote-as 65500
    update-source loopback0
    ebgp-multihop 2
    address-family l2vpn evpn
      send-community
      send-community extended
  template peer spine-underlay
    address-family ipv4 unicast
  neighbor 192.0.2.101
    inherit peer spine-overlay
  neighbor 192.0.2.102
    inherit peer spine-overlay
  neighbor 192.0.2.250
    inherit peer spine-overlay
    remote-as 65510
    peer-type fabric-external
  neighbor 198.51.100.25
    inherit peer spine-underlay
    remote-as 65500
  neighbor 198.51.100.27
    inherit peer spine-underlay
    remote-as 65500
  neighbor 198.51.100.33
    inherit peer spine-underlay
    remote-as 65510
!
evpn
  vni 10010 l2
    rd auto
    route-target import 10:10
    route-target import 65500:10010
    route-target export 10:10
    route-target export 65500:10010
  vni 10020 l2
    rd auto
    route-target import 20:20
    route-target import 65500:10020
    route-target export 20:20
    route-target export 65500:10020