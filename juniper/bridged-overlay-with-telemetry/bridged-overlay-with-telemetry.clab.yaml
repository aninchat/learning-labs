name: juniper-bridged-overlay-with-telemetry
prefix: ""
mgmt:
  network: clab_mgmt
  ipv4-subnet: 172.21.21.0/24
topology:
  defaults:
    kind: juniper_vjunosswitch
  kinds:
    juniper_vjunosswitch:
      image: aninchat/vjunos-switch:23.4R2
      startup-config: configs/__clabNodeName__.txt
    linux:
      image: ghcr.io/srl-labs/network-multitool
      binds:
        - base-configs:/base-configs
  nodes:
    spine1:
      mgmt-ipv4: 172.21.21.101
    spine2:
      mgmt-ipv4: 172.21.21.102
    leaf1:
      mgmt-ipv4: 172.21.21.11
    leaf2:
      mgmt-ipv4: 172.21.21.12
    leaf3:
      mgmt-ipv4: 172.21.21.13
    leaf4:
      mgmt-ipv4: 172.21.21.14
    leaf5:
      mgmt-ipv4: 172.21.21.15
    s1:
      kind: linux
      exec:
        - bash base-configs/s1.sh
    s2:
      kind: linux
      exec:
        - bash base-configs/s2.sh
    s3:
      kind: linux
      exec:
        - bash base-configs/s3.sh
    s4:
      kind: linux
      exec:
        - bash base-configs/s4.sh
    gnmic: 
      kind: linux
      image: ghcr.io/openconfig/gnmic:0.42.1
      mgmt-ipv4: 172.21.21.2
      binds:
        - configs/gnmic/config.yaml:/gnmic-config.yaml:ro
      cmd: --config /gnmic-config.yaml --log subscribe
      ports:
        - 9804:9804
    prometheus:
      kind: linux
      image: prom/prometheus:v3.8.0
      mgmt-ipv4: 172.21.21.3
      binds:
        - configs/prometheus/prometheus.yaml:/etc/prometheus/prometheus.yaml:ro
      cmd: --config.file=/etc/prometheus/prometheus.yaml
      ports:
        - 9091:9090
    grafana:
      kind: linux
      image: grafana/grafana:12.1.4
      ports:
        - 3000:3000
      binds:
        - configs/grafana/datasource.yaml:/etc/grafana/provisioning/datasources/datasource.yaml:ro
        - configs/grafana/dashboards.yaml:/etc/grafana/provisioning/dashboards/dashboards.yaml:ro
        - configs/grafana/dashboards:/var/lib/grafana/dashboards
      env:
        GF_SECURITY_ADMIN_USER: admin
        GF_SECURITY_ADMIN_PASSWORD: admin
  links:
    - endpoints: ["leaf1:eth1", "spine1:eth1"]
    - endpoints: ["leaf1:eth2", "spine2:eth1"]
    - endpoints: ["leaf2:eth1", "spine1:eth2"]
    - endpoints: ["leaf2:eth2", "spine2:eth2"]
    - endpoints: ["leaf3:eth1", "spine1:eth3"]
    - endpoints: ["leaf3:eth2", "spine2:eth3"]
    - endpoints: ["leaf4:eth1", "spine1:eth4"]
    - endpoints: ["leaf4:eth2", "spine2:eth4"]
    - endpoints: ["leaf5:eth1", "spine1:eth5"]
    - endpoints: ["leaf5:eth2", "spine2:eth5"]
    - endpoints: ["leaf1:eth3", "s1:eth1"]
    - endpoints: ["leaf2:eth3", "s2:eth1"]
    - endpoints: ["leaf3:eth3", "s2:eth2"]
    - endpoints: ["leaf4:eth3", "s3:eth1"]
    - endpoints: ["leaf5:eth3", "s4:eth1"]
